== §2 java-gradle-plugin

=== What I'm doing here

Based on the step1, I will introduce the link:https://docs.gradle.org/current/userguide/java_gradle_plugin.html[java-gradle-plugin] into the build.gradle file. With the plugin, the Gradle API becomes available to the `compileGroovy` task.

=== settings.gradle and build.gradle

I made a directory named `step1` where I located `step1/settings.gradle` and `step1/build.gradle`.

==== step2/settings.gradle

[source, groovy]
----
include::../step2/settings.gradle[]
----

==== step2/build.gradle

Refer to link:https://github.com/kazurayam/PublishingCustomGradlePlugin_StepByStep/blob/develop/step2/build.gradle[step2/build.gradle]

Please note the 3rd line, we declare we use the java-gradle-plugin:
[source]
----
include::../step2/build.gradle[lines=3..3]
----

And line#24, we declare the `plugin id` and the name of the implementation  class:
[source, groovy]
----
include::../step2/build.gradle[lines=24..32]
----

You should note that the plugin id can be totally different from the class name. In order to demonstrate this point, I intentionally named the plugin id `org.sample.Greetings` and the fully qualified class name `com.example.greeting.GreeingPlugin`.

The following Gradle document describe how you can name the plugin id:

* link:https://docs.gradle.org/current/userguide/custom_plugins.html#sec:creating_a_plugin_id[creating a plugin id]

=== How the build works

I could compile the Groovy code and run the junit test.

image:images/2.1_success_compile_and_test.png[]

=== Artifacts generated by java-gradle-plugin

In the `step2/build` directory, the java-gradle-plugin generated a lot of artifacts (files). Let's look at them to see what the plugin did for us.

==== build directory

The `java-gradle-plugin` generated several artifacts in the `build` directory.

[source]
----
$ tree ./build
./build
├── classes
│   └── ...
├── generated
│   └── ...
├── pluginDescriptors
│   └── org.sample.Greetings.properties
├── pluginUnderTestMetadata
│   └── ...
├── reports
│   └── ...
├── resources
│   └── main
│       └── META-INF
│           └── gradle-plugins
│               └── org.sample.Greetings.properties
├── test-results
│   └── ...
└── tmp
    ├── ...

47 directories, 20 files
----

Amongst them, the following files are interesting:

`step2/build/pluginDescriptors/org.sample.Greetings.properties`
[source, groovy]
----
include::../step2/build/pluginDescriptors/org.sample.Greetings.properties[]
----

`step2/build/resources/main/META-INF/gradle-plugins/org.sample.Greetings.properties`
[source, groovy]
----
include::../step2/build/resources/main/META-INF/gradle-plugins/org.sample.Greetings.properties[]
----

In the Gradle documentation you can find a description what this properties file is.

* link:https://docs.gradle.org/current/userguide/custom_plugins.html#behind_the_scenes[Behind the scene]